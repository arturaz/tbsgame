package management;

import "base.proto";
import "game.proto";

option java_package = "netmsg";

message FromClient {
  optional AutoRegister auto_register = 1;
  optional CheckNameAvailability check_name_availability = 2;
  optional Register register = 3;
  optional Login login = 4;
  optional JoinGame join_game = 5;
}

message FromServer {
  optional CheckNameAvailabilityResponse check_name_availability = 1;
  optional RegisterResponse register = 2;
  optional LoginResponse login = 3;
  optional GameJoined game_joined = 4;
}

message Credentials {
  required string name = 1;
  // Either password or session token is provided.
  optional string password = 2;
  optional string session_token = 3;
}


/* Generate credentials and log the new user in. */
message AutoRegister {}


/* Check if the name is available */
message CheckNameAvailability {
  required string name = 1;
}
message CheckNameAvailabilityResponse {
  /* Might be that the current name in client isn't one that was checked. */
  required string name = 1;
  required bool available = 2;
}


/* Create a permanent account. */
message Register {
  required string username = 1;
  required string password = 2;
  required string email = 3;
}
message RegisterResponse {
  /* new session token on success */
  optional string new_session_token = 1;
}


message Login {
  required Credentials credentials = 1;
}
message LoginResponse {
  message Data {
    required base.UUID id = 1;
    required string username = 2;
    /* Session token can be used for reauthorization and is stored on the device. */
    required string session_token = 3;
    /* Is this a temporary account? */
    required bool autogenerated = 4;
  }

  // not set if credentials are wrong.
  optional Data data = 1;
}


message JoinGame {}
message GameJoined {
  required game.Player player = 1;
}
